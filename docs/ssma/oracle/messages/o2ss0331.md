---
title: 'O2SS0331: no se puede convertir la instrucción FETCH (error)'
description: Describe por qué SQL Server Migration Assistant (SSMA) para Oracle da un error al convertir la instrucción FETCH en un procedimiento en el que se devuelve un SYS_REFCURSOR como parámetro.
authors: nahk-ivanov
ms.service: ssma
ms.devlang: sql
ms.topic: article
ms.date: 1/22/2020
ms.author: alexiva
ms.openlocfilehash: f2585e378efa9ebf266b5b66b45a187bafac16a6
ms.sourcegitcommit: b87d36c46b39af8b929ad94ec707dee8800950f5
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 02/08/2020
ms.locfileid: "76762259"
---
# <a name="o2ss0331-unable-to-convert-fetch-statement-error"></a>O2SS0331: no se puede convertir la instrucción FETCH (error)

En este artículo se describe por qué SQL Server Migration Assistant (SSMA) para Oracle produce un error `FETCH ... INTO` al convertir la instrucción en un `SYS_REFCURSOR` procedimiento en el que se devuelve como parámetro.

## <a name="background"></a>Información previa

En Oracle, `SYS_REFCURSOR` se usa para pasar cursores de y a un procedimiento almacenado.

Siempre que SSMA encuentra una variable para `SYS_REFCURSOR` como un tipo de valor devuelto del procedimiento y usa la misma variable `FETCH ... INTO` con la instrucción, se genera un mensaje de error.

## <a name="example"></a>Ejemplo

Considere la consulta de ejemplo siguiente en la que hemos declarado una variable `SYS_REFCURSOR`como, que se usa como tipo de valor devuelto de un procedimiento.

```sql
CREATE OR REPLACE PROCEDURE p_close_refcursor
(
    emp_refcur OUT SYS_REFCURSOR
)
IS
    departmentno dept.deptno%TYPE;
BEGIN
    OPEN
        emp_refcur
    FOR
        SELECT deptno
        FROM dept;

    LOOP
        FETCH emp_refcur
        INTO departmentno;

        EXIT WHEN emp_refcur%NOTFOUND;

        DBMS_OUTPUT.PUT_LINE(departmentno);
    END LOOP;

    CLOSE emp_refcur;
END;
```

Al intentar convertir el código anterior en SSMA, se genera el siguiente mensaje de error:

> O2SS0330: no se puede convertir la instrucción FETCH

## <a name="possible-remedies"></a>Posibles soluciones

Hay dos posibles soluciones para corregir este error.

### <a name="use-local-cursor-variable"></a>Usar variable de cursor local

El primer método consiste en crear y usar un cursor local para realizar todas las operaciones y, a continuación, pasar su valor al cursor que se devuelve antes de cerrarlo. Para ello, declare una nueva variable `SYS_REFCURSOR` de tipo que será local para este procedimiento. Modifique el código para utilizar este cursor local para realizar la operación necesaria, `FETCH ... INTO` incluida la instrucción. Antes de cerrar el cursor local, pase el valor de este cursor local al cursor definido en la sección de parámetros de procedure`emp_refcur` (en nuestro ejemplo).

La solución para el error anterior se muestra en el código siguiente:

```sql
CREATE OR REPLACE PROCEDURE p_close_refcursor
(
    emp_refcur OUT SYS_REFCURSOR
)
AS
    test_cursor SYS_REFCURSOR;
    departmentno dept.deptno%TYPE;
BEGIN
    OPEN
        test_cursor
    FOR
        SELECT deptno
        FROM dept;

    LOOP
        FETCH test_cursor
        INTO departmentno;

        EXIT WHEN test_cursor%NOTFOUND;

        DBMS_OUTPUT.PUT_LINE(departmentno);
    END LOOP;

    emp_refcur := test_cursor;

    CLOSE test_cursor;
END;
```

### <a name="return-result-set"></a>Devolver conjunto de resultados

Otra manera de resolver este error es usar el enfoque natural seguido en SQL Server, que devuelve el conjunto de resultados directamente de la ejecución de procedimientos almacenados. Este enfoque se explica en detalles en el artículo sobre el mensaje de conversión de [O2SS0157](o2ss0157.md) .

## <a name="related-conversion-messages"></a>Mensajes de conversión relacionados

* [O2SS0094: no se puede convertir el CURSOR como parámetro](o2ss0094.md)
* [O2SS0157 cadena dinámica para abrir... PARA no convertido](o2ss0157.md)
* [O2SS0245: no se admite la conversión de CURSOres en instrucciones Return](o2ss0245.md)
* [O2SS0330: no se puede convertir la instrucción CLOSE](o2ss0330.md)
